<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Feedback</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feedback-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        .home-btn {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .home-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .metric-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border-left: 5px solid #667eea;
        }

        .metric-label {
            color: #666;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric-value {
            color: #333;
            font-size: 28px;
            font-weight: bold;
        }

        .feedback-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
        }

        .feedback-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feedback-section p {
            color: #555;
            line-height: 1.8;
            font-size: 15px;
            margin-bottom: 10px;
        }

        .feedback-section p:last-child {
            margin-bottom: 0;
        }

        .emoji {
            font-size: 24px;
        }

        .response-time-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .response-category {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-top: 3px solid #667eea;
        }

        .response-category.fast {
            border-top-color: #4CAF50;
        }

        .response-category.average {
            border-top-color: #ffa500;
        }

        .response-category.slow {
            border-top-color: #ff6b6b;
        }

        .response-category-label {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .response-category-value {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            border: 2px solid #ddd;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
            border-color: #999;
        }

        .overall-rating {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-radius: 12px;
            border: 2px solid #667eea;
        }

        .rating-stars {
            font-size: 48px;
            margin: 15px 0;
        }

        .rating-text {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }

        @media (max-width: 600px) {
            .feedback-container {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .response-time-breakdown {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="feedback-container">
        <a href="index.html" class="home-btn">üè† Home</a>
        
        <h1>üìä Your Quiz Feedback</h1>
        <p class="subtitle">Personalized insights based on your performance</p>

        <div class="overall-rating">
            <div class="rating-text" id="overall-rating">Excellent Performance!</div>
            <div class="rating-stars" id="rating-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">Total Time Spent</div>
                <div class="metric-value" id="total-time">00:00</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Answer Changes</div>
                <div class="metric-value" id="answer-changes">0</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Score</div>
                <div class="metric-value" id="score-display">0/0</div>
            </div>
        </div>
        <div class="feedback-section">
            <h3><span class="emoji">üéØ</span> Confidence vs Score Feedback</h3>
            <p id="confidence-alignment-feedback">Your confidence alignment feedback will appear here.</p>
        </div>

        <div class="feedback-section">
            <h3><span class="emoji">‚è±Ô∏è</span> Time Management Feedback</h3>
            <p id="time-feedback">Your time usage is optimal.</p>
        </div>

        <div class="feedback-section">
            <h3><span class="emoji">üîÑ</span> Decision Confidence Feedback</h3>
            <p id="confidence-feedback">You made confident decisions with very few answer changes.</p>
        </div>

        <div class="feedback-section">
            <h3><span class="emoji">üí°</span> Test Taking Recommendation</h3>
            <p id="recommendation">Keep up the great work and continue practicing!</p>
        </div>

        <div class="feedback-section">
            <h3><span class="emoji">üìö</span> Knowledge & Understanding Analysis</h3>
            <p id="understanding-feedback">Your understanding of the material is developing.</p>
        </div>

        <div class="feedback-section">
            <h3><span class="emoji">‚ö°</span> Response Time Analysis</h3>
            <p id="pace-feedback">Your response times show a balanced approach.</p>
            <div class="response-time-breakdown">
                <div class="response-category fast">
                    <div class="response-category-label">Fast</div>
                    <div class="response-category-value" id="fast-display">0</div>
                </div>
                <div class="response-category average">
                    <div class="response-category-label">Average</div>
                    <div class="response-category-value" id="avg-display">0</div>
                </div>
                <div class="response-category slow">
                    <div class="response-category-label">Slow</div>
                    <div class="response-category-value" id="slow-display">0</div>
                </div>
            </div>
        </div>

        <div class="button-group">
            <a href="question-bank.html" class="btn btn-primary">üìö Take Another Quiz</a>
            <a href="index.html" class="btn btn-secondary">üè† Back to Home</a>
        </div>
    </div>
    

    <script>
        // Retrieve quiz data from localStorage
        const quizData = JSON.parse(localStorage.getItem('quizFeedbackData') || '{}');

        if (!quizData || Object.keys(quizData).length === 0) {
            document.body.innerHTML = '<div class="feedback-container"><h1>No Quiz Data Found</h1><p>Please complete a quiz first.</p><a href="index.html" class="btn btn-primary" style="margin-top: 20px;">Back to Home</a></div>';
        } else {
            // Extract data
            const totalTime = quizData.totalTime || '00:00';
            const answerChanges = quizData.answerChanges || 0;
            const score = quizData.score || 0;
            const totalQuestions = quizData.totalQuestions || 1;
            const fastCount = quizData.fastCount || 0;
            const avgCount = quizData.avgCount || 0;
            const slowCount = quizData.slowCount || 0;
            const scorePercentage = Math.round((score / totalQuestions) * 100);
            const baseConfidenceValue = Number.isFinite(quizData.baseConfidence)
                ? quizData.baseConfidence
                : parseFloat(quizData.baseConfidence);
            const baseConfidence = Number.isFinite(baseConfidenceValue)
                ? Math.max(0, Math.min(100, baseConfidenceValue))
                : 50;

            // Update metric displays
            document.getElementById('total-time').textContent = totalTime;
            document.getElementById('answer-changes').textContent = answerChanges;
            document.getElementById('score-display').textContent = `${score}/${totalQuestions}`;
            document.getElementById('fast-display').textContent = fastCount;
            document.getElementById('avg-display').textContent = avgCount;
            document.getElementById('slow-display').textContent = slowCount;

            // Generate feedback based on metrics
            const feedbacks = generateFeedback(totalTime, answerChanges, fastCount, avgCount, slowCount, scorePercentage, score, totalQuestions, baseConfidence);

            // Update feedback sections
            document.getElementById('time-feedback').textContent = feedbacks.timeFeedback;
            document.getElementById('confidence-feedback').textContent = feedbacks.confidenceFeedback;
            document.getElementById('pace-feedback').textContent = feedbacks.paceFeedback;
            document.getElementById('recommendation').textContent = feedbacks.recommendation;
            document.getElementById('understanding-feedback').textContent = feedbacks.understandingFeedback;
            document.getElementById('confidence-alignment-feedback').textContent = feedbacks.confidenceAlignmentFeedback;
            
            // Update overall rating
            document.getElementById('overall-rating').textContent = feedbacks.overallRating;
            document.getElementById('rating-stars').textContent = feedbacks.stars;
        }

        function generateFeedback(totalTime, answerChanges, fastCount, avgCount, slowCount, scorePercentage, score, totalQuestions, baseConfidence) {
            const timeMatch = totalTime.match(/(\d+):(\d+)/);
            const timeInSeconds = (parseInt(timeMatch[1]) * 60) + parseInt(timeMatch[2]);
            const avgTimePerQuestion = totalQuestions > 0 ? timeInSeconds / totalQuestions : 0;

            // Determine time category
            const totalResponses = fastCount + avgCount + slowCount;
            const slowPercentage = totalResponses > 0 ? (slowCount / totalResponses) * 100 : 0;
            const isHighTime = avgTimePerQuestion > 45 || slowPercentage > 30;
            const isLowTime = avgTimePerQuestion < 30;

            // Determine swap category
            const swapPercentage = totalQuestions > 0 ? (answerChanges / totalQuestions) * 100 : 0;
            const isHighSwaps = swapPercentage >= 25;
            const isLowSwaps = swapPercentage < 25;

            let feedback = {};

            // TIME FEEDBACK
            if (avgTimePerQuestion < 20) {
                feedback.timeFeedback = `You completed the quiz in just ${totalTime} (average ${avgTimePerQuestion.toFixed(1)}s per question). Your swift pace suggests quick thinking, but ensure you're not rushing through important details.`;
            } else if (avgTimePerQuestion < 45) {
                feedback.timeFeedback = `Your total time of ${totalTime} (average ${avgTimePerQuestion.toFixed(1)}s per question) shows excellent time management. You balanced speed with thoroughness.`;
            } else if (avgTimePerQuestion < 90) {
                feedback.timeFeedback = `You took ${totalTime} to complete the quiz (average ${avgTimePerQuestion.toFixed(1)}s per question). You were thoughtful in your approach, though you might work on increasing your speed.`;
            } else {
                feedback.timeFeedback = `Your quiz took ${totalTime} (average ${avgTimePerQuestion.toFixed(1)}s per question). You took plenty of time to consider each question, which helped with accuracy, but try to build faster decision-making skills.`;
            }

            // CONFIDENCE/ANSWER CHANGES FEEDBACK
            if (answerChanges === 0) {
                feedback.confidenceFeedback = `Excellent! You made no answer changes, showing strong conviction in your choices. This indicates confidence and decisiveness.`;
            } else if (answerChanges <= 2) {
                feedback.confidenceFeedback = `You changed your answer ${answerChanges} time(s), which is minimal. You demonstrated good confidence in your initial choices.`;
            } else if (answerChanges <= 5) {
                feedback.confidenceFeedback = `You made ${answerChanges} answer changes. This shows some uncertainty, but it's reasonable‚Äîchanging answers when unsure can sometimes improve accuracy.`;
            } else {
                feedback.confidenceFeedback = `You changed your answers ${answerChanges} times. While reconsidering answers can be helpful, frequent changes might indicate overthinking or low initial confidence.`;
            }

            // PACE FEEDBACK (Response Time Analysis)
            const fastPercent = totalResponses > 0 ? (fastCount / totalResponses) * 100 : 0;
            const avgPercent = totalResponses > 0 ? (avgCount / totalResponses) * 100 : 0;

            if (fastPercent > 60) {
                feedback.paceFeedback = `${fastCount} of your ${totalResponses} responses were fast. You have an impressive ability to recognize answers quickly, but verify you're maintaining accuracy.`;
            } else if (avgPercent > 50) {
                feedback.paceFeedback = `Most of your responses (${avgCount}) were at an average pace. This balanced approach suggests you're carefully considering each question while maintaining good speed.`;
            } else if (slowPercentage > 40) {
                feedback.paceFeedback = `You spent extra time on ${slowCount} questions, showing careful consideration. This deliberate approach helps with accuracy on challenging questions.`;
            } else {
                feedback.paceFeedback = `Your responses were well-distributed across fast (${fastCount}), average (${avgCount}), and slow (${slowCount}) categories, showing adaptive thinking.`;
            }

            // PERSONALIZED RECOMMENDATION based on Time and Swap categories
            if (isHighTime && isHighSwaps) {
                feedback.recommendation = `You spent a considerable amount of time on the questions. Continuing to develop efficient strategies for discriminating between similar answer choices may help improve pacing and decision making.`;
            } else if (isLowTime && isHighSwaps) {
                feedback.recommendation = `You completed the questions quickly but changed answers often. Focusing on careful discrimination between similar options before selecting an answer may help balance speed with consistency.`;
            } else if (isHighTime && isLowSwaps) {
                feedback.recommendation = `You show strong focus and commitment to your answers. Consider working on pacing to improve efficiency.`;
            } else if (isLowTime && isLowSwaps) {
                feedback.recommendation = `Excellent efficiency. Your decision-making appears clear and consistent.`;
            } else {
                // Default/middle ground
                feedback.recommendation = `Keep up the great work and continue practicing!`;
            }

            // UNDERSTANDING/KNOWLEDGE ANALYSIS based on score percentage
            if (scorePercentage <= 25) {
                feedback.understandingFeedback = 'Please reread your notes and articles to improve your understanding, while also writing additional notes to improve your understanding of the concepts.';
            } else if (scorePercentage <= 50) {
                feedback.understandingFeedback = 'You have some key concepts written in your notes but you struggled with remembering the topics on the quiz.';
            } else if (scorePercentage <= 75) {
                feedback.understandingFeedback = 'You remember most key concepts from the article and your notes but you may have struggled with remembering more unique concepts.';
            } else {
                feedback.understandingFeedback = 'You have an excellent understanding of key and unique topics. Keep on with using your notes for summary of key concepts.';
            }

            // CONFIDENCE VS SCORE FEEDBACK
            const confidenceDelta = baseConfidence - scorePercentage;
            const absConfidenceDelta = Math.abs(confidenceDelta);

            if (absConfidenceDelta <= 20 && scorePercentage >= 75) {
                feedback.confidenceAlignmentFeedback = 'Excellent work. You answered correctly and your confidence matched your understanding. This shows strong mastery and accurate self-assessment. Keep approaching questions with this level of clarity and conviction.';
            } else if (confidenceDelta < -20) {
                feedback.confidenceAlignmentFeedback = 'You answered correctly, but you weren\'t fully confident. This suggests you understand the material better than you think. Try to trust your reasoning process ‚Äî your instincts are stronger than you\'re giving yourself credit for.';
            } else if (confidenceDelta > 20) {
                feedback.confidenceAlignmentFeedback = 'Your answer was incorrect, but you felt confident. This may indicate a misunderstanding or an assumption that needs revisiting. Take a moment to review this concept carefully and reflect on where your reasoning diverged from the correct logic.';
            } else {
                feedback.confidenceAlignmentFeedback = 'Your answer was incorrect, and you weren\'t fully confident ‚Äî which shows healthy awareness of uncertainty. This is a great opportunity to strengthen your understanding. Review the concept and aim to turn uncertainty into clarity.';
            }

            // OVERALL RATING
            let ratingScore = 0;
            if (scorePercentage >= 80) ratingScore += 2;
            else if (scorePercentage >= 60) ratingScore += 1;

            if (answerChanges <= 2) ratingScore += 2;
            else if (answerChanges <= 5) ratingScore += 1;

            if (avgTimePerQuestion >= 30 && avgTimePerQuestion <= 60) ratingScore += 2;
            else if (avgTimePerQuestion >= 20 && avgTimePerQuestion <= 90) ratingScore += 1;

            let stars = '';
            let overallText = '';
            if (ratingScore >= 6) {
                stars = '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê';
                overallText = 'Excellent Performance! üéØ';
            } else if (ratingScore >= 5) {
                stars = '‚≠ê‚≠ê‚≠ê‚≠ê';
                overallText = 'Very Good Job! üëè';
            } else if (ratingScore >= 3) {
                stars = '‚≠ê‚≠ê‚≠ê';
                overallText = 'Good Effort! üí™';
            } else if (ratingScore >= 1) {
                stars = '‚≠ê‚≠ê';
                overallText = 'You\'re Making Progress! üìà';
            } else {
                stars = '‚≠ê';
                overallText = 'Keep Practicing! üöÄ';
            }

            feedback.stars = stars;
            feedback.overallRating = overallText;

            return feedback;
        }

        // Clear data after displaying (optional - for privacy)
        // localStorage.removeItem('quizFeedbackData');
    </script>
</body>
</html>
